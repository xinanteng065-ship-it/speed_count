<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Speed Count</title>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs"></script>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow-models/pose-detection"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }
        
        .container {
            background: white;
            border-radius: 20px;
            padding: 40px;
            max-width: 900px;
            width: 100%;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }
        
        h1 {
            text-align: center;
            color: #667eea;
            margin-bottom: 30px;
            font-size: 2.5em;
        }
        
        .mode-selector {
            display: flex;
            gap: 15px;
            margin-bottom: 30px;
        }
        
        .mode-btn {
            flex: 1;
            padding: 15px;
            border: 3px solid #667eea;
            background: white;
            border-radius: 10px;
            cursor: pointer;
            font-size: 1.1em;
            font-weight: bold;
            color: #667eea;
            transition: all 0.3s;
        }
        
        .mode-btn.active {
            background: #667eea;
            color: white;
        }
        
        .mode-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102,126,234,0.3);
        }
        
        .video-container {
            position: relative;
            width: 100%;
            max-width: 640px;
            margin: 0 auto 20px;
            border-radius: 10px;
            overflow: hidden;
            background: #000;
        }
        
        #video {
            width: 100%;
            height: auto;
            display: block;
        }
        
        #canvas {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }
        
        .display-area {
            text-align: center;
            margin: 30px 0;
        }
        
        .jump-count {
            font-size: 5em;
            font-weight: bold;
            color: #667eea;
            margin: 20px 0;
            transition: transform 0.1s;
        }
        
        .timer {
            font-size: 2.5em;
            color: #764ba2;
            margin: 20px 0;
        }
        
        .status {
            font-size: 1.3em;
            color: #666;
            margin: 15px 0;
            min-height: 30px;
        }
        
        .controls {
            display: flex;
            gap: 15px;
            margin-top: 30px;
        }
        
        .control-btn {
            flex: 1;
            padding: 20px;
            border: none;
            border-radius: 10px;
            font-size: 1.2em;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .start-btn {
            background: #48bb78;
            color: white;
        }
        
        .start-btn:hover:not(:disabled) {
            background: #38a169;
            transform: translateY(-2px);
        }
        
        .stop-btn {
            background: #f56565;
            color: white;
        }
        
        .stop-btn:hover:not(:disabled) {
            background: #e53e3e;
            transform: translateY(-2px);
        }
        
        .control-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .results {
            margin-top: 30px;
            padding: 20px;
            background: #f7fafc;
            border-radius: 10px;
            display: none;
        }
        
        .results.show {
            display: block;
        }
        
        .results h2 {
            color: #667eea;
            margin-bottom: 15px;
        }
        
        .countdown-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
        
        .countdown-overlay.show {
            display: flex;
        }
        
        .countdown-number {
            font-size: 15em;
            font-weight: bold;
            color: white;
            animation: countdownPulse 1s;
        }
        
        @keyframes countdownPulse {
            0% { transform: scale(0.5); opacity: 0; }
            50% { transform: scale(1.2); }
            100% { transform: scale(1); opacity: 1; }
        }
        
        .chart-container {
            margin-top: 20px;
            padding: 25px;
            background: white;
            border-radius: 15px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }
        
        .chart-title {
            font-weight: bold;
            color: #667eea;
            margin-bottom: 20px;
            font-size: 1.2em;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .bar-chart {
            display: flex;
            align-items: flex-end;
            height: 200px;
            gap: 8px;
            margin-top: 20px;
            padding: 10px;
            background: linear-gradient(to top, #f7fafc 0%, white 100%);
            border-radius: 10px;
            position: relative;
        }
        
        .bar-chart::before {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 1px;
            background: #e2e8f0;
        }
        
        .bar {
            flex: 1;
            background: linear-gradient(to top, #667eea, #764ba2);
            border-radius: 8px 8px 0 0;
            position: relative;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 -2px 10px rgba(102, 126, 234, 0.2);
            min-height: 20px;
        }
        
        .bar:hover {
            transform: translateY(-5px);
            box-shadow: 0 -5px 20px rgba(102, 126, 234, 0.4);
            filter: brightness(1.1);
        }
        
        .bar-label {
            position: absolute;
            bottom: -30px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 0.75em;
            color: #64748b;
            white-space: nowrap;
            font-weight: 600;
        }
        
        .bar-value {
            position: absolute;
            top: -25px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 0.9em;
            font-weight: bold;
            color: #667eea;
            background: white;
            padding: 2px 8px;
            border-radius: 5px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }
        
        .stat-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 20px;
            border-radius: 15px;
            color: white;
            text-align: center;
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);
            transition: transform 0.3s;
        }
        
        .stat-card:hover {
            transform: translateY(-5px);
        }
        
        .stat-label {
            font-size: 0.9em;
            opacity: 0.9;
            margin-bottom: 8px;
        }
        
        .stat-value {
            font-size: 2em;
            font-weight: bold;
        }
        
        .stat-unit {
            font-size: 0.7em;
            opacity: 0.8;
        }
        
        .ai-advice {
            margin-top: 20px;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 10px;
        }
        
        .ai-advice h3 {
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .ai-advice p {
            line-height: 1.6;
        }
        
        .loading {
            text-align: center;
            color: #667eea;
            font-weight: bold;
            padding: 20px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Speed Count</h1>
        
        <div class="mode-selector">
            <button class="mode-btn active" data-duration="30">30Áßí„Çπ„Éî„Éº„Éâ</button>
            <button class="mode-btn" data-duration="180">3ÂàÜ„Çπ„Éî„Éº„Éâ</button>
        </div>
        
        <div class="video-container" id="videoContainer">
            <video id="video" autoplay playsinline></video>
            <canvas id="canvas"></canvas>
        </div>
        
        <div class="display-area">
            <div class="status" id="status">
                <div class="loading">Ë™≠„ÅøËæº„Åø‰∏≠...</div>
            </div>
            <div class="timer" id="timer">00:00</div>
            <div class="jump-count" id="jumpCount">0</div>
        </div>
        
        <div class="controls">
            <button class="control-btn start-btn" id="startBtn" disabled>„Çπ„Çø„Éº„Éà</button>
            <button class="control-btn stop-btn" id="stopBtn" disabled>„Çπ„Éà„ÉÉ„Éó</button>
        </div>
        
        <div class="results" id="results">
            <h2>üìä ÁµêÊûú</h2>
            
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-label">Á∑èË∑≥Ë∫çÊï∞</div>
                    <div class="stat-value"><span id="finalCount">0</span><span class="stat-unit">Âõû</span></div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Âπ≥Âùá„Éö„Éº„Çπ</div>
                    <div class="stat-value"><span id="avgPace">0.0</span><span class="stat-unit">Âõû/Áßí</span></div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">ÊúÄÈ´ò„Éö„Éº„Çπ</div>
                    <div class="stat-value"><span id="maxPace">0</span><span class="stat-unit">Âõû/10Áßí</span></div>
                </div>
            </div>
            
            <div class="chart-container">
                <div class="chart-title">üìà 10Áßí„Åî„Å®„ÅÆË∑≥Ë∫çÊï∞Êé®Áßª</div>
                <div class="bar-chart" id="barChart"></div>
            </div>
            
            <div class="ai-advice">
                <h3>ü§ñ „Ç¢„Éâ„Éê„Ç§„Çπ</h3>
                <p id="aiAdvice">Ë®àÊ∏¨„ÇíÂÆå‰∫Ü„Åô„Çã„Å®„ÄÅ„Éë„Éï„Ç©„Éº„Éû„É≥„ÇπÂàÜÊûê„Å®„Ç¢„Éâ„Éê„Ç§„Çπ„ÅåË°®Á§∫„Åï„Çå„Åæ„Åô„ÄÇ</p>
            </div>
        </div>
    </div>
    
    <div class="countdown-overlay" id="countdownOverlay">
        <div class="countdown-number" id="countdownNumber">5</div>
    </div>

    <script>
        let selectedDuration = 30;
        let jumpCount = 0;
        let isRunning = false;
        let timeRemaining = 0;
        let timerInterval = null;
        let lastJumpTime = 0;
        const minJumpInterval = 200;
        let jumpHistory = [];
        let segmentJumps = [];
        let currentSegmentStart = 0;
        
        let video, canvas, ctx;
        let detector = null;
        let isModelLoading = false;
        let lastRightKneeY = null;
        let isLanding = false;
        
        const modeBtns = document.querySelectorAll('.mode-btn');
        const startBtn = document.getElementById('startBtn');
        const stopBtn = document.getElementById('stopBtn');
        const statusEl = document.getElementById('status');
        const timerEl = document.getElementById('timer');
        const jumpCountEl = document.getElementById('jumpCount');
        const resultsEl = document.getElementById('results');
        const countdownOverlay = document.getElementById('countdownOverlay');
        const countdownNumber = document.getElementById('countdownNumber');
        
        video = document.getElementById('video');
        canvas = document.getElementById('canvas');
        ctx = canvas.getContext('2d');
        
        modeBtns.forEach(btn => {
            btn.addEventListener('click', () => {
                if (isRunning) return;
                modeBtns.forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                selectedDuration = parseInt(btn.dataset.duration);
                updateTimer(selectedDuration);
                resultsEl.classList.remove('show');
            });
        });
        
        async function loadPoseDetectionModel() {
            isModelLoading = true;
            
            try {
                const detectorConfig = {
                    modelType: poseDetection.movenet.modelType.SINGLEPOSE_LIGHTNING,
                    enableSmoothing: true
                };
                detector = await poseDetection.createDetector(
                    poseDetection.SupportedModels.MoveNet, 
                    detectorConfig
                );
                isModelLoading = false;
                await initCamera();
            } catch (err) {
                console.error('„É¢„Éá„É´Ë™≠„ÅøËæº„Åø„Ç®„É©„Éº:', err);
                statusEl.innerHTML = '<div style="color: #f56565;">AI„É¢„Éá„É´„ÅÆË™≠„ÅøËæº„Åø„Å´Â§±Êïó„Åó„Åæ„Åó„Åü</div>';
                isModelLoading = false;
            }
        }
        
        async function initCamera() {
            try {
                const stream = await navigator.mediaDevices.getUserMedia({ 
                    video: { 
                        width: 640, 
                        height: 480,
                        facingMode: 'user'
                    } 
                });
                video.srcObject = stream;
                
                return new Promise((resolve) => {
                    video.onloadedmetadata = () => {
                        canvas.width = video.videoWidth;
                        canvas.height = video.videoHeight;
                        startPoseDetection();
                        statusEl.textContent = 'Ê∫ñÂÇôÂÆå‰∫ÜÔºÅ„Çπ„Çø„Éº„Éà„Éú„Çø„É≥„ÇíÊäº„Åó„Å¶„Åè„Å†„Åï„ÅÑ';
                        startBtn.disabled = false;
                        resolve(true);
                    };
                });
            } catch (err) {
                console.error('„Ç´„É°„É©„Ç¢„ÇØ„Çª„Çπ„Ç®„É©„Éº:', err);
                statusEl.innerHTML = '<div style="color: #f56565;">„Ç´„É°„É©„Å∏„ÅÆ„Ç¢„ÇØ„Çª„Çπ„ÅåÂøÖË¶Å„Åß„Åô</div>';
                alert('„Ç´„É°„É©„Å∏„ÅÆ„Ç¢„ÇØ„Çª„Çπ„ÇíË®±ÂèØ„Åó„Å¶„Åè„Å†„Åï„ÅÑ');
                return false;
            }
        }
        
        function startPoseDetection() {
            setInterval(async () => {
                if (!detector) return;
                
                try {
                    const poses = await detector.estimatePoses(video);
                    
                    ctx.clearRect(0, 0, canvas.width, canvas.height);
                    
                    if (poses.length > 0) {
                        const pose = poses[0];
                        const keypoints = pose.keypoints;
                        
                        const rightKnee = keypoints.find(kp => kp.name === 'right_knee');
                        const rightAnkle = keypoints.find(kp => kp.name === 'right_ankle');
                        const rightHip = keypoints.find(kp => kp.name === 'right_hip');
                        
                        if (rightKnee && rightKnee.score > 0.3) {
                            ctx.beginPath();
                            ctx.arc(rightKnee.x, rightKnee.y, 10, 0, 2 * Math.PI);
                            ctx.fillStyle = '#00ff00';
                            ctx.fill();
                            ctx.strokeStyle = '#00ff00';
                            ctx.lineWidth = 3;
                            ctx.stroke();
                            
                            if (rightHip && rightHip.score > 0.3) {
                                ctx.beginPath();
                                ctx.moveTo(rightHip.x, rightHip.y);
                                ctx.lineTo(rightKnee.x, rightKnee.y);
                                ctx.strokeStyle = '#00ff00';
                                ctx.lineWidth = 5;
                                ctx.stroke();
                            }
                            
                            if (rightAnkle && rightAnkle.score > 0.3) {
                                ctx.beginPath();
                                ctx.moveTo(rightKnee.x, rightKnee.y);
                                ctx.lineTo(rightAnkle.x, rightAnkle.y);
                                ctx.strokeStyle = '#00ff00';
                                ctx.lineWidth = 5;
                                ctx.stroke();
                            }
                            
                            if (isRunning && lastRightKneeY !== null) {
                                const movement = rightKnee.y - lastRightKneeY;
                                const now = Date.now();
                                
                                if (movement > 15 && !isLanding && (now - lastJumpTime) > minJumpInterval) {
                                    isLanding = true;
                                    registerJump();
                                } else if (movement < -10) {
                                    isLanding = false;
                                }
                            }
                            
                            lastRightKneeY = rightKnee.y;
                        }
                    }
                } catch (err) {
                    console.error('ÂßøÂã¢Ê§úÂá∫„Ç®„É©„Éº:', err);
                }
            }, 100);
        }
        
        function speak(text) {
            const utterance = new SpeechSynthesisUtterance(text);
            utterance.lang = 'ja-JP';
            utterance.rate = 1.0;
            speechSynthesis.speak(utterance);
        }
        
        function updateTimer(seconds) {
            const mins = Math.floor(seconds / 60);
            const secs = seconds % 60;
            timerEl.textContent = `${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
        }
        
        async function countdown() {
            return new Promise((resolve) => {
                let count = 5;
                countdownOverlay.classList.add('show');
                
                const countInterval = setInterval(() => {
                    countdownNumber.textContent = count;
                    
                    if (count === 1) {
                        setTimeout(() => {
                            clearInterval(countInterval);
                            countdownOverlay.classList.remove('show');
                            resolve();
                        }, 1000);
                    }
                    count--;
                }, 1000);
            });
        }
        
        function registerJump() {
            jumpCount++;
            jumpCountEl.textContent = jumpCount;
            lastJumpTime = Date.now();
            
            jumpCountEl.style.transform = 'scale(1.2)';
            setTimeout(() => {
                jumpCountEl.style.transform = 'scale(1)';
            }, 100);
            
            jumpHistory.push({
                time: selectedDuration - timeRemaining,
                count: jumpCount
            });
        }
        
        function startTimer() {
            timerInterval = setInterval(() => {
                timeRemaining--;
                updateTimer(timeRemaining);
                
                const elapsed = selectedDuration - timeRemaining;
                
                if (elapsed > 0 && elapsed % 10 === 0) {
                    const jumpsInSegment = jumpCount - currentSegmentStart;
                    segmentJumps.push(jumpsInSegment);
                    currentSegmentStart = jumpCount;
                }
                
                if (timeRemaining <= 0) {
                    endSession();
                }
            }, 1000);
        }
        
        async function startSession() {
            resultsEl.classList.remove('show');
            jumpCount = 0;
            jumpHistory = [];
            segmentJumps = [];
            currentSegmentStart = 0;
            timeRemaining = selectedDuration;
            jumpCountEl.textContent = '0';
            updateTimer(timeRemaining);
            lastRightKneeY = null;
            isLanding = false;
            
            startBtn.disabled = true;
            stopBtn.disabled = false;
            
            const durationText = selectedDuration === 30 ? '30Áßí' : '3ÂàÜ';
            statusEl.textContent = '„Ç´„Ç¶„É≥„Éà„ÉÄ„Ç¶„É≥ÈñãÂßã...';
            
            await countdown();
            
            statusEl.textContent = 'Ë®àÊ∏¨‰∏≠... üìπ Âè≥Ë∂≥ÁùÄÂú∞„ÇíÊ§úÂá∫‰∏≠';
            isRunning = true;
            
            startTimer();
        }
        
        function endSession() {
            isRunning = false;
            clearInterval(timerInterval);
            
            startBtn.disabled = false;
            stopBtn.disabled = true;
            
            const finalJumps = jumpCount - currentSegmentStart;
            if (finalJumps > 0) {
                segmentJumps.push(finalJumps);
            }
            
            speak(`ÁµÇ‰∫Ü„Åß„Åô„ÄÇ${jumpCount}ÂõûË∑≥„Å≥„Åæ„Åó„Åü„ÄÇ`);
            statusEl.textContent = 'Ë®àÊ∏¨ÂÆå‰∫ÜÔºÅ';
            
            displayResults();
        }
        
        function displayResults() {
            const avgPace = (jumpCount / selectedDuration).toFixed(2);
            const maxSegment = Math.max(...segmentJumps);
            
            document.getElementById('finalCount').textContent = jumpCount;
            document.getElementById('avgPace').textContent = avgPace;
            document.getElementById('maxPace').textContent = maxSegment;
            
            const barChart = document.getElementById('barChart');
            barChart.innerHTML = '';
            
            const maxHeight = Math.max(...segmentJumps);
            
            segmentJumps.forEach((jumps, index) => {
                const bar = document.createElement('div');
                bar.className = 'bar';
                const heightPercent = maxHeight > 0 ? (jumps / maxHeight) * 100 : 0;
                
                setTimeout(() => {
                    bar.style.height = `${heightPercent}%`;
                }, index * 100);
                
                const label = document.createElement('div');
                label.className = 'bar-label';
                label.textContent = `${(index + 1) * 10}Áßí`;
                
                const value = document.createElement('div');
                value.className = 'bar-value';
                value.textContent = jumps;
                
                bar.appendChild(label);
                bar.appendChild(value);
                barChart.appendChild(bar);
            });
            
            generateAIAdvice(avgPace, maxSegment, segmentJumps);
            
            setTimeout(() => {
                resultsEl.classList.add('show');
            }, 300);
        }
        
        function generateAIAdvice(avgPace, maxSegment, segments) {
            let advice = '';
            
            if (avgPace >= 5.0) {
                advice = `Á¥†Êô¥„Çâ„Åó„ÅÑ„Éö„Éº„Çπ„Åß„ÅôÔºÅÂπ≥Âùá${avgPace}Âõû/Áßí„ÅØÈùûÂ∏∏„Å´È´ò„ÅÑ„É¨„Éô„É´„Åß„Åô„ÄÇ`;
            } else if (avgPace >= 4.0) {
                advice = `ËâØÂ•Ω„Å™„Éö„Éº„Çπ„Åß„ÅôÔºÅÂπ≥Âùá${avgPace}Âõû/Áßí„ÇíÁ∂≠ÊåÅ„Åß„Åç„Å¶„ÅÑ„Åæ„Åô„ÄÇ`;
            } else if (avgPace >= 3.0) {
                advice = `Âπ≥Âùá${avgPace}Âõû/Áßí„ÅÆ„Éö„Éº„Çπ„Åß„Åô„ÄÇ„Åï„Çâ„Å™„ÇãÂêë‰∏ä„ÇíÁõÆÊåá„Åó„Åæ„Åó„Çá„ÅÜÔºÅ`;
            } else {
                advice = `Âπ≥Âùá${avgPace}Âõû/Áßí„Åß„Åô„ÄÇÁ∑¥Áøí„ÇíÈáç„Å≠„Å¶„Éö„Éº„Çπ„Ç¢„ÉÉ„Éó„ÇíÁõÆÊåá„Åó„Åæ„Åó„Çá„ÅÜ„ÄÇ`;
            }
            
            const firstHalf = segments.slice(0, Math.floor(segments.length / 2));
            const secondHalf = segments.slice(Math.floor(segments.length / 2));
            const firstAvg = firstHalf.reduce((a, b) => a + b, 0) / firstHalf.length;
            const secondAvg = secondHalf.reduce((a, b) => a + b, 0) / secondHalf.length;
            
            if (secondAvg > firstAvg * 1.1) {
                advice += ' ÂæåÂçä„Å´„Éö„Éº„Çπ„Ç¢„ÉÉ„Éó„Åß„Åç„Å¶„ÅÑ„Åæ„Åô„ÄÇ„Çπ„Çø„Éü„Éä„ÅåÂçÅÂàÜ„Å´„ÅÇ„Çã„ÅÆ„Åß„ÄÅÂâçÂçä„Åã„Çâ„ÇÇ„ÅÜÂ∞ë„ÅóÊîª„ÇÅ„Å¶„ÇÇËâØ„ÅÑ„Åã„ÇÇ„Åó„Çå„Åæ„Åõ„Çì„ÄÇ';
            } else if (firstAvg > secondAvg * 1.2) {
                advice += ' ÂâçÂçä„ÅÆ„Éö„Éº„Çπ„ÅåÈÄü„Åè„ÄÅÂæåÂçä„Å´„Éö„Éº„Çπ„ÉÄ„Ç¶„É≥„Åó„Å¶„ÅÑ„Åæ„Åô„ÄÇÊåÅ‰πÖÂäõ„ÅÆÂº∑Âåñ„ÇÑ„Éö„Éº„ÇπÈÖçÂàÜ„ÅÆË¶ãÁõ¥„Åó„Çí„Åä„Åô„Åô„ÇÅ„Åó„Åæ„Åô„ÄÇ';
            } else {
                advice += ' ÂÆâÂÆö„Åó„Åü„Éö„Éº„Çπ„ÅßË∑≥„Åπ„Å¶„ÅÑ„Åæ„Åô„ÄÇ„Åì„ÅÆ„É™„Ç∫„É†„ÇíÁ∂≠ÊåÅ„Åó„Å™„Åå„Çâ„ÄÅÂÖ®‰Ωì„ÅÆ„Çπ„Éî„Éº„Éâ„Ç¢„ÉÉ„Éó„ÇíÁõÆÊåá„Åó„Åæ„Åó„Çá„ÅÜ„ÄÇ';
            }
            
            const variance = segments.reduce((sum, val) => {
                const diff = val - (jumpCount / segments.length);
                return sum + diff * diff;
            }, 0) / segments.length;
            
            if (variance < 5) {
                advice += ' „Éö„Éº„Çπ„ÅåÈùûÂ∏∏„Å´ÂÆâÂÆö„Åó„Å¶„ÅÑ„Åæ„Åô„ÄÇÊ¨°„ÅØ„Çπ„Éî„Éº„Éâ„Ç¢„ÉÉ„Éó„Å´„ÉÅ„É£„É¨„É≥„Ç∏„Åó„Å¶„Åø„Åæ„Åó„Çá„ÅÜÔºÅ';
            }
            
            document.getElementById('aiAdvice').textContent = advice;
        }
        
        startBtn.addEventListener('click', startSession);
        
        stopBtn.addEventListener('click', () => {
            if (confirm('Ë®àÊ∏¨„Çí‰∏≠Ê≠¢„Åó„Åæ„Åô„ÅãÔºü')) {
                endSession();
            }
        });
        
        updateTimer(selectedDuration);
        loadPoseDetectionModel();
    </script>
</body>
</html>